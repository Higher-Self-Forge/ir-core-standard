{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://ir-standard.org/schemas/v1.0/consent-record.schema.json",
  "$comment": "IR v1.0 Core Standard | Copyright (c) 2026 Qori Labs | CC-BY-NC-SA-4.0",
  "title": "IR Consent Record (FPIC)",
  "description": "A Free, Prior, and Informed Consent (FPIC) record for a defined scope. Consent records are governance artifacts that support CARE Principles-aligned data sovereignty (Collective Benefit, Authority to Control, Responsibility, Ethics). Implementations MUST support status transitions and SHOULD preserve evidence pointers sufficient for audit.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "consent_id",
    "subject_type",
    "scope",
    "granted_at",
    "granted_by",
    "status"
  ],
  "properties": {
    "consent_id": {
      "type": "string",
      "minLength": 1,
      "description": "Unique consent record identifier (UUID/URI)."
    },
    "subject_type": {
      "type": "string",
      "enum": [
        "individual",
        "household",
        "community",
        "organization",
        "collective"
      ],
      "description": "Type of consenting subject. CARE alignment note: when the subject is collective/community, governance processes SHOULD reflect collective decision-making authority."
    },
    "scope": {
      "$ref": "#/$defs/ConsentScope",
      "description": "Defines what is being consented to (data categories, processing, beneficiaries, geography, and purpose). CARE alignment note: scope SHOULD be specific enough to support Authority to Control and Ethics review."
    },
    "granted_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when consent was granted."
    },
    "granted_by": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id"
      ],
      "description": "Identifier of the consenting authority (person, council, or mandated representative). CARE alignment note: record how authority was established.",
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1,
          "description": "Identifier (DID/URI/local principal)."
        },
        "name": {
          "type": "string",
          "description": "Human-readable name."
        },
        "role": {
          "type": "string",
          "description": "Role or mandate (e.g., 'council_delegate', 'elder', 'guardian')."
        },
        "authority_basis": {
          "type": "string",
          "description": "Description/reference for how authority to grant consent was validated (e.g., meeting minutes, charter clause)."
        }
      }
    },
    "status": {
      "type": "string",
      "enum": [
        "active",
        "revoked",
        "expired",
        "superseded"
      ],
      "description": "Current consent status. Implementations MUST enforce scope only when status is 'active'."
    },
    "conditions": {
      "type": "array",
      "description": "Optional conditions attached to the consent (e.g., retention limits, allowed recipients, restrictions on model features). CARE alignment note: conditions operationalize Responsibility and Ethics.",
      "items": {
        "type": "string"
      }
    },
    "expiry": {
      "type": "string",
      "format": "date-time",
      "description": "Optional expiration timestamp after which status SHOULD become 'expired'."
    },
    "revoked_at": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when consent was revoked, if applicable."
    },
    "revocation_reason": {
      "type": "string",
      "description": "Reason for revocation, if provided by the subject/community."
    },
    "linked_features": {
      "type": "array",
      "description": "Optional list of system features enabled under this consent (e.g., 'predictive_yield', 'resource_allocation').",
      "items": {
        "type": "string",
        "minLength": 1
      }
    },
    "evidence_refs": {
      "type": "array",
      "description": "References to supporting materials (meeting minutes, translated materials, recordings, photos of signed forms). SHOULD avoid embedding sensitive content directly; use pointers and hashes.",
      "items": {
        "$ref": "#/$defs/EvidenceRef"
      }
    },
    "supersedes": {
      "type": "string",
      "description": "Optional identifier of a prior consent record that this record supersedes."
    },
    "signatures": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Signature"
      },
      "description": "Optional signatures/proofs over the consent record or consent_id + scope."
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "description": "Optional metadata (locale, facilitation notes, consent session identifiers)."
    }
  },
  "$defs": {
    "ConsentScope": {
      "title": "Consent Scope",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "purpose",
        "data_categories",
        "processing",
        "beneficiaries"
      ],
      "properties": {
        "purpose": {
          "type": "string",
          "minLength": 1,
          "description": "Declared purpose for data use (must be community-legible)."
        },
        "data_categories": {
          "type": "array",
          "minItems": 1,
          "description": "Categories of data covered by this consent.",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "processing": {
          "type": "array",
          "minItems": 1,
          "description": "Allowed processing activities (e.g., 'collect', 'store', 'train', 'infer', 'share_with_partners').",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "beneficiaries": {
          "type": "array",
          "minItems": 1,
          "description": "Who benefits / who may access outputs (e.g., 'community_members', 'local_coop', 'named_partner:QoriLabs').",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "geography": {
          "type": "string",
          "description": "Optional geographic constraint (e.g., 'within {{COMMUNITY_NAME}} territory')."
        },
        "retention": {
          "type": "string",
          "description": "Optional retention constraint (e.g., '30 months' or 'until next planting season')."
        },
        "derivatives": {
          "type": "string",
          "description": "Optional rules for derivative outputs (models, embeddings, reports)."
        },
        "notes": {
          "type": "string",
          "description": "Optional community-legible notes clarifying the scope."
        }
      }
    },
    "EvidenceRef": {
      "title": "Evidence Reference",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "ref"
      ],
      "properties": {
        "type": {
          "type": "string",
          "minLength": 1,
          "description": "Evidence type (e.g., 'minutes', 'photo', 'audio', 'video', 'translation', 'presentation')."
        },
        "ref": {
          "type": "string",
          "minLength": 1,
          "description": "Pointer to evidence (URI, content-addressed hash, or local storage locator)."
        },
        "hash": {
          "type": "string",
          "pattern": "^(?:[A-Fa-f0-9]{64}|z[1-9A-HJ-NP-Za-km-z]+|u[A-Za-z0-9\\-_]+)$",
          "description": "Optional integrity hash for the evidence content."
        },
        "language": {
          "type": "string",
          "description": "Optional language tag (e.g., 'es-PE', 'quz')."
        }
      }
    },
    "Signature": {
      "title": "Signature / Proof",
      "description": "A compact signature/proof object aligned with common W3C Verifiable Credentials proof fields. Implementations MAY use JWS, Linked Data Proofs, or other mechanisms. When present, fields SHOULD be sufficient to verify the attestation.",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "created",
        "verificationMethod",
        "proofPurpose"
      ],
      "properties": {
        "type": {
          "type": "string",
          "minLength": 1,
          "description": "Signature/proof suite identifier (e.g., 'Ed25519Signature2020', 'JsonWebSignature2020', or 'Jws2020')."
        },
        "created": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp when the proof was created (RFC 3339 / ISO 8601)."
        },
        "verificationMethod": {
          "type": "string",
          "minLength": 1,
          "description": "A URI identifying the verification method (often a DID URL)."
        },
        "proofPurpose": {
          "type": "string",
          "enum": [
            "assertionMethod",
            "authentication",
            "capabilityInvocation",
            "capabilityDelegation"
          ],
          "description": "Purpose of the proof, per VC patterns."
        },
        "domain": {
          "type": "string",
          "description": "Optional domain separation string to prevent cross-protocol replay."
        },
        "challenge": {
          "type": "string",
          "description": "Optional challenge/nonce to prevent replay."
        },
        "jws": {
          "type": "string",
          "description": "Detached or embedded JWS representation, if applicable."
        },
        "proofValue": {
          "type": "string",
          "description": "Base58/base64 proof value, if applicable (alternative to JWS)."
        },
        "cryptosuite": {
          "type": "string",
          "description": "Cryptographic suite identifier for data integrity proofs, if applicable."
        }
      }
    }
  },
  "examples": [
    {
      "consent_id": "urn:ir:consent:cusco-ayllu:2026-0007",
      "subject_type": "community",
      "scope": {
        "purpose": "Support irrigation scheduling and reduce water waste during dry season",
        "data_categories": [
          "irrigation_sensor",
          "weather_observation",
          "field_boundary"
        ],
        "processing": [
          "collect",
          "store",
          "infer"
        ],
        "beneficiaries": [
          "community_members",
          "local_water_committee"
        ],
        "geography": "Within {{COMMUNITY_NAME}} watershed territory",
        "retention": "24 months",
        "derivatives": "Models trained under this consent MUST NOT be shared externally without new FPIC"
      },
      "granted_at": "2026-01-09T19:00:00Z",
      "granted_by": {
        "id": "did:web:ayllu.example.org#council",
        "name": "Ayllu Council",
        "role": "council",
        "authority_basis": "Council Charter v1.0 Â§Decision-Making Process; Meeting minutes DEC-REG-2026-01-09"
      },
      "status": "active",
      "conditions": [
        "No individual household-level profiling",
        "Monthly transparency report shared in community assembly"
      ],
      "linked_features": [
        "irrigation_advice_v1"
      ],
      "evidence_refs": [
        {
          "type": "minutes",
          "ref": "local://evidence/DEC-REG-2026-01-09.pdf",
          "hash": "b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2b2",
          "language": "es-PE"
        }
      ]
    }
  ]
}
